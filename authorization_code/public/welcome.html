<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Spotify FM</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  </head>

<body>

  <div class="container-fluid">
    
    <div class="row">
      <div class="col-sm-12">
        <h1>Welcome</h1>
        <a href="/addplaylist">Create My Playlist and get started.</a>
      </div>
    </div>
    <div class="row">
      
      <div class="col-sm-4">
        <div class="form-group">
           <label for="exampleInputEmail1">Search</label>
           <input type="text" class="form-control" id="search" placeholder="Search">
         </div>

         <div class="playlists">
           
         </div>
      </div>
      
      <div class="col-sm-8">

        <div id="tracks" class="list-group">

        </div>
        
        <div class="artists">
          <ul>
            
          </ul>
        </div>

      </div>

    </div>
  </div>

<script>

var delay = (function(){
      var timer = 0;
      return function(callback, ms){
        clearTimeout (timer);
        timer = setTimeout(callback, ms);
      };
    })();

$( document ).ready(function() {

    $("#search").focus();


    $( "#search" ).keyup(function() {

        delay(function(){

            var input = $('#search').val();
            $("#tracks").empty();

            $.get( "/search", { search: input } )
            .done(function( data ) {
            $.each( data, function( k, v ) {
              
              html = '<a href="#" data-id="' + v.id + '" class="list-group-item">'
              + v.name + ' | ' + v.artists[0].name
              + '</a>';
              $("#tracks").append(html);

            });
              
            });

        }, 500); 
    });


    $('#tracks').on('click', 'a', function() {
      var trackid = $(this).data('id');
      $.get( "/addTrack", { track: trackid } )
      .done(function( data ) {
        console.log('track added');
      });
    });

    $('.get-playlists').on('click', function() {

      $.get( "/getPlaylist")
      .done(function( data ) {
        console.log('playlist route hit');
      });
    });

});

</script>

</body>
</html>
